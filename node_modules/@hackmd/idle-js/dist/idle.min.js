"use strict";function noop(){}class Idle{constructor(i){this.isAway=!1,this.awayTimeout=3e3,this.awayTimestamp=0,this.awayTimer=null,this.onAway=noop,this.onAwayBack=noop,this.onVisible=noop,this.onHidden=noop,this.listener=null,i&&(this.awayTimeout=parseInt(i.awayTimeout,10),this.onAway=i.onAway||noop,this.onAwayBack=i.onAwayBack||noop,this.onVisible=i.onVisible||noop,this.onHidden=i.onHidden||noop);const e=()=>this.onActive();window.addEventListener("click",e),window.addEventListener("mousemove",e),window.addEventListener("mouseenter",e),window.addEventListener("keydown",e),window.addEventListener("scroll",e),window.addEventListener("mousewheel",e),window.addEventListener("touchmove",e),window.addEventListener("touchstart",e)}onActive(){return this.awayTimestamp=(new Date).getTime()+this.awayTimeout,this.isAway&&(this.onAwayBack(),this.start()),this.isAway=!1,!0}start(){return this.listener||(this.listener=(i=>{this.handleVisibilityChange()}),document.addEventListener("visibilitychange",this.listener,!1),document.addEventListener("webkitvisibilitychange",this.listener,!1),document.addEventListener("msvisibilitychange",this.listener,!1)),this.awayTimestamp=(new Date).getTime()+this.awayTimeout,null!==this.awayTimer&&clearTimeout(this.awayTimer),this.awayTimer=window.setTimeout(()=>{this.checkAway()},this.awayTimeout+100),this}stop(){return null!=this.awayTimer&&clearTimeout(this.awayTimer),null!==this.listener&&(document.removeEventListener("visibilitychange",this.listener),document.removeEventListener("webkitvisibilitychange",this.listener),document.removeEventListener("msvisibilitychange",this.listener),this.listener=null),this}setAwayTimeout(i){return this.awayTimeout=i,this}checkAway(){const i=(new Date).getTime();if(i<this.awayTimestamp)return this.isAway=!1,void(this.awayTimer=window.setTimeout(()=>{this.checkAway()},this.awayTimestamp-i+100));null!=this.awayTimer&&clearTimeout(this.awayTimer),this.isAway=!0,this.onAway()}handleVisibilityChange(){document.hidden||document.msHidden||document.webkitHidden?this.onHidden():this.onVisible()}}module.exports=Idle;
